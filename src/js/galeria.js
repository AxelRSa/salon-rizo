// SVG's
SVGs = {
 modalCircle:
  '<svg class="sliderPoint" onclick="slider1()" id="point1" height="100" width="100" viewBox="0 0 200 200"><circle id="circle1" cx="100" cy="100" r="30" fill="#fff" style="r: 70;"></circle></svg>',
 carousel:
  '<svg aria-label="Carousel" class="_8-yf5 " fill="#ffffff" height="22" viewBox="0 0 48 48" width="22"><path d="M34.8 29.7V11c0-2.9-2.3-5.2-5.2-5.2H11c-2.9 0-5.2 2.3-5.2 5.2v18.7c0 2.9 2.3 5.2 5.2 5.2h18.7c2.8-.1 5.1-2.4 5.1-5.2zM39.2 15v16.1c0 4.5-3.7 8.2-8.2 8.2H14.9c-.6 0-.9.7-.5 1.1 1 1.1 2.4 1.8 4.1 1.8h13.4c5.7 0 10.3-4.6 10.3-10.3V18.5c0-1.6-.7-3.1-1.8-4.1-.5-.4-1.2 0-1.2.6z"></path></svg>',
 video:
  '<svg aria-label="Video" class="_8-yf5 " fill="#ffffff" height="18" viewBox="0 0 48 48" width="18"><path d="M9.6 46.5c-1 0-2-.3-2.9-.8-1.8-1.1-2.9-2.9-2.9-5.1V7.3c0-2.1 1.1-4 2.9-5.1 1.9-1.1 4.1-1.1 5.9 0l30.1 17.6c1.5.9 2.3 2.4 2.3 4.1 0 1.7-.9 3.2-2.3 4.1L12.6 45.7c-.9.5-2 .8-3 .8z"></path></svg>',
 silence:
  '<svg aria-label="Audo is muted." class="_8-yf5 " fill="#ffffff" height="12" viewBox="0 0 48 48" width="12"><path clip-rule="evenodd" d="M1.5 13.3c-.8 0-1.5.7-1.5 1.5v18.4c0 .8.7 1.5 1.5 1.5h8.7l12.9 12.9c.9.9 2.5.3 2.5-1v-9.8c0-.4-.2-.8-.4-1.1l-22-22c-.3-.3-.7-.4-1.1-.4h-.6zm46.8 31.4l-5.5-5.5C44.9 36.6 48 31.4 48 24c0-11.4-7.2-17.4-7.2-17.4-.6-.6-1.6-.6-2.2 0L37.2 8c-.6.6-.6 1.6 0 2.2 0 0 5.7 5 5.7 13.8 0 5.4-2.1 9.3-3.8 11.6L35.5 32c1.1-1.7 2.3-4.4 2.3-8 0-6.8-4.1-10.3-4.1-10.3-.6-.6-1.6-.6-2.2 0l-1.4 1.4c-.6.6-.6 1.6 0 2.2 0 0 2.6 2 2.6 6.7 0 1.8-.4 3.2-.9 4.3L25.5 22V1.4c0-1.3-1.6-1.9-2.5-1L13.5 10 3.3-.3c-.6-.6-1.5-.6-2.1 0L-.2 1.1c-.6.6-.6 1.5 0 2.1L4 7.6l26.8 26.8 13.9 13.9c.6.6 1.5.6 2.1 0l1.4-1.4c.7-.6.7-1.6.1-2.2z" fill-rule="evenodd"></path></svg>',
 audioOn:
  '<svg aria-label="Audio is playing" class="_8-yf5 " fill="#ffffff" height="12" viewBox="0 0 48 48" width="12"><path clip-rule="evenodd" d="M40.8 6.6c-.6-.6-1.6-.6-2.2 0L37.2 8c-.6.6-.6 1.6 0 2.2 0 0 5.7 5 5.7 13.8s-5.7 13.8-5.7 13.8c-.6.6-.6 1.6 0 2.2l1.4 1.4c.6.6 1.6.6 2.2 0 0 0 7.2-6 7.2-17.4S40.8 6.6 40.8 6.6zm-7.1 7.1c-.6-.6-1.6-.6-2.2 0l-1.4 1.4c-.6.6-.6 1.6 0 2.2 0 0 2.6 2 2.6 6.7s-2.6 6.7-2.6 6.7c-.6.6-.6 1.6 0 2.2l1.4 1.4c.6.6 1.6.6 2.2 0 0 0 4.1-3.5 4.1-10.3s-4.1-10.3-4.1-10.3zM23.1.4L10.2 13.3H1.5c-.8 0-1.5.7-1.5 1.5v18.4c0 .8.7 1.5 1.5 1.5h8.7l12.9 12.9c.9.9 2.5.3 2.5-1V1.4C25.5.2 24-.5 23.1.4z" fill-rule="evenodd"></path></svg>',
 rightArrow:
  '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><g><g><g><path d="M256,0C114.618,0,0,114.618,0,256s114.618,256,256,256s256-114.618,256-256S397.382,0,256,0z M256,469.333     c-117.818,0-213.333-95.515-213.333-213.333S138.182,42.667,256,42.667S469.333,138.182,469.333,256S373.818,469.333,256,469.333     z"/><path d="M228.418,134.248c-8.331-8.331-21.839-8.331-30.17,0c-8.331,8.331-8.331,21.839,0,30.17L289.83,256l-91.582,91.582     c-8.331,8.331-8.331,21.839,0,30.17c8.331,8.331,21.839,8.331,30.17,0l106.667-106.667c8.331-8.331,8.331-21.839,0-30.17     L228.418,134.248z"/></g></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>',
 leftArrow:
  '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;transform:rotate(180deg)" xml:space="preserve"><g><g><g><path d="M256,0C114.618,0,0,114.618,0,256s114.618,256,256,256s256-114.618,256-256S397.382,0,256,0z M256,469.333     c-117.818,0-213.333-95.515-213.333-213.333S138.182,42.667,256,42.667S469.333,138.182,469.333,256S373.818,469.333,256,469.333     z"/><path d="M228.418,134.248c-8.331-8.331-21.839-8.331-30.17,0c-8.331,8.331-8.331,21.839,0,30.17L289.83,256l-91.582,91.582     c-8.331,8.331-8.331,21.839,0,30.17c8.331,8.331,21.839,8.331,30.17,0l106.667-106.667c8.331-8.331,8.331-21.839,0-30.17     L228.418,134.248z"/></g></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>',
};

// class
class galeriaPublication {
 constructor(id, order, caption, permalink, type, img, vid, children) {
  this.id = id;
  this.order = order;
  this.caption = caption;
  this.permalink = permalink;
  this.container;
  this.type = type;
  this.img = img;
  this.vid = vid;
  this.children = children;
  this.childrenDisplay = 0;
 }
 setContainer(container) {
  this.container = container;
 }
 setChildrenDisplay(value) {
  this.childrenDisplay += value;
 }
 printImg() {
  let newImg;
  newImg = document.createElement("div");
  newImg.classList.add("galeriaImg");
  if (this.type == "CAROUSEL_ALBUM") {
   newImg.innerHTML = `<div class='loaderImg'></div><div class='galeriaImgContainer'><div class='galeriaSVG'>${SVGs["carousel"]}</div><img class ='galeriaImages' src='${this.img}' loading="lazy" alt='${this.caption}'></div>`;
  } else if (this.type == "VIDEO") {
   newImg.innerHTML = `<div class='loaderImg'></div><div class='galeriaImgContainer'><div class='galeriaSVG'>${SVGs["video"]}</div><img class ='galeriaImages' src='${this.img}' loading="lazy" alt='${this.caption}'>`;
  } else {
   newImg.innerHTML = `<div class='loaderImg'></div><div class='galeriaImgContainer'><img class ='galeriaImages' src='${this.img}' loading="lazy" alt='${this.caption}'></div>`;
  }
  this.setContainer(newImg);
  return this.container;
 }
 modalDisplay(ele) {
  galeriaModalLoader.classList.remove("active");
  galeriaArrowCR.onclick = function () {
   self.galleryDisplay = ele.order;
   self.changeModal(self.gallery[parseInt(self.galleryDisplay) + 1]);
  };
  galeriaArrowCL.onclick = function () {
   self.galleryDisplay = ele.order;
   self.changeModal(self.gallery[parseInt(self.galleryDisplay) - 1]);
  };
  self.galleryDisplay = ele.order;
  if (self.galleryDisplay == 0) {
   galeriaArrowCL.style.visibility = "hidden";
   galeriaArrowCR.style.visibility = "visible";
  } else if (self.galleryDisplay == galeriaTotalImg.innerHTML - 1) {
   galeriaArrowCL.style.visibility = "visible";
   galeriaArrowCR.style.visibility = "hidden";
  } else if (self.galleryDisplay == self.gallery.length - 1) {
   galeriaArrowCL.style.visibility = "visible";
   let originalContent = galeriaArrowCR.innerHTML;
   galeriaArrowCR.innerHTML = "Ver más";
   galeriaArrowCR.onclick = function () {
    newGaleria.galleryButton();
    galeriaArrowCR.innerHTML = originalContent;
    galeriaArrowCR.onclick = function () {
     self.changeModal(self.gallery[parseInt(self.galleryDisplay) + 1]);
    };
   };
  } else {
   galeriaArrowCL.style.visibility = "visible";
   galeriaArrowCR.style.visibility = "visible";
  }
  galeriaModal.classList = "galeriaImages active";
  galeriaActualImg.innerHTML = parseInt(ele.order) + 1 + " /";
  galeriaClose.onclick = function () {
   galeriaModal.classList = "galeriaImages inactive";
   galeriaModalContent.removeChild(document.querySelector("#newContent"));
  };
  // children
  if (ele.type == "CAROUSEL_ALBUM") {
   if (ele.children[ele.childrenDisplay].media_type == "VIDEO") {
    var newContent = document.createElement("div");
    let newVideo = document.createElement("video");
    newContent.id = "newContent";
    newVideo.controls = true;
    newVideo.autoplay = true;
    newVideo.loop = true;
    newVideo.innerHTML =
     '<source src="' +
     ele.children[ele.childrenDisplay].url +
     '" type="video/mp4">';
    newVideo.onloadstart = function () {
     galeriaModalLoader.classList.add("active");
    };
    newContent.appendChild(newVideo);
   } else if (ele.children[ele.childrenDisplay].media_type == "IMAGE") {
    var newContent = document.createElement("div");
    let newImg = document.createElement("img");
    newContent.id = "newContent";
    newImg.onload = function () {
     galeriaModalLoader.classList.remove("inactive");
     galeriaModalLoader.classList.add("active");
    };
    newImg.src = ele.children[ele.childrenDisplay].url;
    newImg.onload = function () {
     galeriaModalLoader.classList.add("active");
    };
    newContent.appendChild(newImg);
   }
   galeriaModalContent.appendChild(newContent);
   // leftArrow
   let carouselArrowL = document.createElement("div");
   carouselArrowL.id = "carouselL";
   carouselArrowL.innerHTML = SVGs["leftArrow"];
   newContent.appendChild(carouselArrowL);
   carouselLFunction(carouselL, ele);

   // rightArrow
   let carouselArrowR = document.createElement("div");
   carouselArrowR.id = "carouselR";
   carouselArrowR.innerHTML = SVGs["rightArrow"];
   newContent.appendChild(carouselArrowR);
   carouselRFunction(carouselR, ele);
   let circleSpace = document.createElement("div");
   circleSpace.id = "circleSpace";
   ele.children.forEach((el) => {
    circleSpace.innerHTML += SVGs["modalCircle"];
   });
   newContent.appendChild(circleSpace);
   circleSpace.children[ele.childrenDisplay].style = "transform:scale(1.5);";
   // arrowDisplay
   if (ele.childrenDisplay == 0) {
    carouselL.style.visibility = "hidden";
    carouselR.style.visibility = "visible";
   } else if (ele.childrenDisplay == ele.children.length - 1) {
    carouselL.style.visibility = "visible";
    carouselR.style.visibility = "hidden";
   } else if (ele.childrenDisplay != 0) {
    carouselL.style.visibility = "visible";
    carouselR.style.visibility = "visible";
   }
   // children
  } else if (ele.type == "VIDEO") {
   let newContent = document.createElement("div");
   let newVideo = document.createElement("video");
   newContent.id = "newContent";
   newVideo.controls = true;
   newVideo.autoplay = true;
   newVideo.loop = true;
   newVideo.innerHTML = '<source src="' + ele.vid + '" type="video/mp4">';
   newVideo.onloadstart = function () {
    galeriaModalLoader.classList.add("active");
   };
   newContent.appendChild(newVideo);
   galeriaModalContent.appendChild(newContent);
  } else {
   let newContent = document.createElement("div");
   let newImg = document.createElement("img");
   newContent.id = "newContent";
   newImg.src = ele.img;
   newImg.onload = function () {
    galeriaModalLoader.classList.add("active");
   };
   newContent.appendChild(newImg);
   galeriaModalContent.appendChild(newContent);
  }
 }
}
class galeria {
 constructor() {
  this.gallery = [];
  self = this;
  this.galeriaStatus = 0;
  this.galleryDisplay = 0;
 }
 getPublications(url) {
  let ajax = new XMLHttpRequest();
  ajax.onreadystatechange = function () {
   if (ajax.readyState === 4) {
    let api = JSON.parse(ajax.responseText)["items"];
    if (!galeriaTotalImg.innerHTML) {
     galeriaTotalImg.innerHTML = JSON.parse(ajax.responseText)["count"];
    }
    api.forEach((e) => {
     let img = new galeriaPublication(
      e.id,
      e.order,
						e.caption,
						e.permalink,
      e.type,
      e.img,
      e.vid,
      e.children
     );
     galeriaContainer.appendChild(img.printImg());
     self.gallery.push(img);
    });
    imgLoader();
    self.openModal();
   }
  };
  ajax.open("GET", url);
  ajax.send();
 }
 openModal() {
  this.gallery.forEach((ele) => {
   ele.container.onclick = function () {
    ele.modalDisplay(ele);
   };
  });
 }
 changeModal(ele) {
  galeriaModalContent.removeChild(newContent);
  ele.modalDisplay(ele);
 }
 galleryButton() {
  if (this.galeriaStatus == 0) {
   this.galeriaStatus = 1;
   galeriaButton.innerHTML = "Contraer";
   newGaleria.getPublications(
    "https://salonrizo.com/src/api/?rest=" + sizePrincipalGallery
   );
  } else {
   imgLoader();
   this.galeriaStatus = 0;
   galeriaButton.innerHTML = "Ver más";
   this.gallery.splice(sizePrincipalGallery);
   let galleryComplete = document.querySelectorAll(".galeriaImg");
   galleryComplete.forEach((e, i = 0) => {
    if (i >= sizePrincipalGallery) {
     galeriaContainer.removeChild(e);
    }
    i++;
   });
  }
 }
}

// functions
function imgLoader() {
 loaderImg = document.querySelectorAll(".loaderImg");
 galeriaImages = document.querySelectorAll(".galeriaImages");
 galeriaImages.forEach((e) => {
  e.onload = function () {
   e.parentElement.parentElement.children[0].className += " active";
   e.parentElement.children[0].className += " active";
  };
 });
}
function carouselLFunction(ele, object) {
 ele.onclick = function () {
  object.setChildrenDisplay(-1);
  galeriaModalContent.removeChild(newContent);
  object.modalDisplay(object);
 };
}
function carouselRFunction(ele, object) {
 ele.onclick = function () {
  object.setChildrenDisplay(+1);
  galeriaModalContent.removeChild(newContent);
  object.modalDisplay(object);
 };
}

//variables
sizePrincipalGallery = 12;

// init
newGaleria = new galeria("");
newGaleria.getPublications(
 "https://salonrizo.com/src/api/?last=" + sizePrincipalGallery
);

// listeners
galeriaButton.onclick = function () {
 newGaleria.galleryButton();
};
